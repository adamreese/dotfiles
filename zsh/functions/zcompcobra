# ------------------------------------------------------------------------------
# zcompcobra
#
# compile and source cobra style zsh completions
# ------------------------------------------------------------------------------

autoload -Uz zrecompile

typeset cachefile=${ZSH_CACHE_DIR}/${1}.zsh

if [[ ! -s ${cachefile} || ${commands[${1}]} -nt ${cachefile} ]]; then
  "${1}" completion zsh | egrep -v 'compinit' >| ${cachefile}
fi

zrecompile -p "${cachefile}" && command rm -f "${cachefile}.zwc.old"
[[ -s "${cachefile}.zwc" ]] || zcompile ${cachefile}

emulate bash -c 'source "${cachefile}"'

# ------------------------------------------------------------------------------
# vim:ft=zsh
