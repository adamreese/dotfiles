#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

item=${1:-deps}

package="${PWD#$GOPATH/src/}"

packages() {
  go list "${package}/..." | grep -vF "${package}/vendor"
}

not_stdlib() {
  xargs go list -f '{{if not .Standard}}{{.ImportPath}}{{end}}' || :
}

not_internal() {
  grep -v "${package}"
}

packages | xargs go list -f '{{join .'${item^}' "\n"}}' | sort -u | not_stdlib | not_internal

